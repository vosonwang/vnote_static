NProgress.configure({showSpinner:false});toastr.options={positionClass:"toast-top-center",timeOut:"1000",preventDuplicates:true,showMethod:"slideDown",hideMethod:"fadeOut"};moment.locale("zh-cn");let vaste=new Vue({el:"#note",data:{note:"",record:{},shortId:location.href.split("/",4)[3],notes:[],checkedNotes:[],allCheck:false},watch:{allCheck:function(d,c){let _self=this;if(d){this.notes.forEach(function(e){_self.checkedNotes.push(e.id)})}else{this.checkedNotes=[]}}},mounted:function(){this.$nextTick(function(){this.findByShortID()});this.getAllNotes()},computed:{formatNote:function(){let _self=this,key="updatetime",b=JSON.parse(JSON.stringify(_self.notes));if(b.length!==0){return bubbleSort(b,key).filter(function(c){if(c.updatetime!==null){c.updatetime=moment(c.updatetime).fromNow()}c.createtime=moment(c.createtime).format("MMM Do");if(c.note!==null&&c.note.length>60){c.note=c.note.slice(0,60)+"..."}return c})}else{return null}},row:function(){return this.note&&_.difference(this.note.split("\n"),[""])},characters:function(){let a={length:0,isClear:false};if(this.note.indexOf("\n")>=0||this.note.indexOf(" ")>=0){a.isClear=true}a.length=this.note.length;return a}},methods:{findByShortID:function(){let _self=this;if(/\d{1,4}/i.test(_self.shortId)){$.ajax({type:"get",url:"/notes/"+_self.shortId,beforeSend:function(){NProgress.start()},success:function(c){if(c!==null&&c!==""){_self.record=c;_self.note=c.note}else{console.log(c)}},error:function(c){toastr.error("获取内容失败！");console.log(c)},complete:function(){NProgress.done()}})}},create:function(){$.ajax({type:"post",url:"/shortids",beforeSend:function(){NProgress.start()},success:function(c){if(c!==null&&c!==""){window.location.href="/"+c}else{toastr.error("新建笔记失败！");console.log(c)}},error:function(c){toastr.error("获取内容失败！");console.log(c)},complete:function(){NProgress.done()}})},getAllNotes:function(){let _self=this;$.ajax({type:"get",url:"/notes",beforeSend:function(){NProgress.start()},success:function(c){if(c!==null&&c!==""){_self.notes=c}else{toastr.error("获取内容失败！");console.log(c)}},error:function(c){toastr.error("获取内容失败！");console.log(c)},complete:function(){NProgress.done()}})},save:function(){let _self=this;if(_self.note!==""){$.ajax({type:"post",url:"/notes",data:{note:_self.note,shortId:_self.shortId},beforeSend:function(){NProgress.start()},success:function(c){if(c!==null&&c!==""){toastr.success("保存成功！");_self.record=c}else{toastr.error("保存失败！")}},error:function(c){toastr.error("保存失败！");console.log(c)},complete:function(){NProgress.done()}})}},deleteNote:function(){let _self=this;$.ajax({type:"DELETE",url:"/notes/"+_self.shortId,beforeSend:function(){NProgress.start()},success:function(c){if(typeof c==="number"){if(c===0){toastr.warning("该记录不存在！")}else{window.location.href="/list.html"}}else{console.log(c)}},error:function(c){toastr.error("获取内容失败！");console.log(c)},complete:function(){NProgress.done()}})},deleteNotes:function(){let _self=this;if(this.checkedNotes.length!==0){$.ajax({type:"DELETE",url:"/notes",dataType:"json",contentType:"application/json",data:JSON.stringify(_self.checkedNotes),beforeSend:function(){NProgress.start()},success:function(c){if(typeof c==="number"){if(c===0){toastr.warning("记录不存在！")}else{if(c===_self.checkedNotes.length){toastr.success("删除成功！");_self.getAllNotes();_self.checkedNotes=[];_self.allCheck=false}else{toastr.warning("有"+(_self.checkedNotes.length-c)+"未成功删除！");_self.getAllNotes()}}}else{console.log(c)}},error:function(c){toastr.error("获取内容失败！");console.log(c)},complete:function(){NProgress.done()}})}}}});