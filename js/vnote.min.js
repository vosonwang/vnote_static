NProgress.configure({showSpinner:false});toastr.options={positionClass:"toast-top-center",timeOut:"1000",preventDuplicates:true,showMethod:"slideDown",hideMethod:"fadeOut"};moment.locale("zh-cn");let vaste=new Vue({el:"#note",data:{note:"",record:{},shortId:location.href.split("/",4)[3],notes:[]},mounted:function(){this.$nextTick(function(){this.findByShortID()});this.getAllNotes()},computed:{formatNote:function(){let _self=this,key="updatetime";if(this.notes.length!==0){return bubbleSort(_self.notes,key).filter(function(b){if(b.updatetime!==null){b.updatetime=moment(b.updatetime).fromNow()}b.createtime=moment(b.createtime).format("MMM Do YYYY");if(b.note!==null&&b.note.length>60){b.note=b.note.slice(0,60)+"..."}return b})}else{return null}}},methods:{findByShortID:function(){let _self=this;if(/\d{1,4}/i.test(_self.shortId)){$.ajax({type:"get",url:"/notes/"+_self.shortId,beforeSend:function(){NProgress.start()},success:function(a){if(a!==null&&a!==""){_self.record=a;_self.note=a.note}else{console.log(a)}},error:function(a){toastr.error("获取内容失败！");console.log(a)},complete:function(){NProgress.done()}})}},create:function(){$.ajax({type:"post",url:"/shortids",beforeSend:function(){NProgress.start()},success:function(a){if(a!==null&&a!==""){window.location.href="/"+a}else{toastr.error("新建笔记失败！");console.log(a)}},error:function(a){toastr.error("获取内容失败！");console.log(a)},complete:function(){NProgress.done()}})},getAllNotes:function(){let _self=this;$.ajax({type:"get",url:"/notes",beforeSend:function(){NProgress.start()},success:function(a){if(a!==null&&a!==""){_self.notes=a}else{toastr.error("获取内容失败！");console.log(a)}},error:function(a){toastr.error("获取内容失败！");console.log(a)},complete:function(){NProgress.done()}})},save:function(){let _self=this;if(_self.note!==""){$.ajax({type:"post",url:"/notes",data:{note:_self.note,shortId:_self.shortId},beforeSend:function(){NProgress.start()},success:function(a){if(a!==null&&a!==""){toastr.success("保存成功！");_self.record=a}else{toastr.error("保存失败！")}},error:function(a){toastr.error("保存失败！");console.log(a)},complete:function(){NProgress.done()}})}},deleteNote:function(){let _self=this;$.ajax({type:"DELETE",url:"/notes/"+_self.shortId,beforeSend:function(){NProgress.start()},success:function(a){if(typeof a==="number"){if(a===0){toastr.warning("该记录不存在！")}else{window.location.href="/list.html"}}else{console.log(a)}},error:function(a){toastr.error("获取内容失败！");console.log(a)},complete:function(){NProgress.done()}})}}});